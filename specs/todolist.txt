<project_specification>
  <project_name>autoo-todo - Small Full-Stack Todo Application</project_name>

  <overview>
    A small, polished todo list application with a TypeScript/React 19 frontend and a TypeScript/Express backend. The app supports creating, viewing, updating, completing, and deleting todos, plus basic organization with filters, optional lists, and tags. The focus is on correctness, clean UX, accessible UI, and a simple maintainable API built on the Spernakit stack with JSON-driven configuration.
  </overview>

  <technology_stack>
    <api_key>
      No API key required for this application
    </api_key>
    <frontend>
      <framework>React 19 with Vite 5</framework>
      <styling>Tailwind CSS with DaisyUI component library</styling>
      <state_management>React hooks; optional Zustand if needed</state_management>
      <routing>Optional (single-page is fine); React Router if adding multiple views</routing>
      <data_fetching>TanStack Query (React Query) for server state</data_fetching>
      <testing>Vitest + React Testing Library</testing>
      <port>Only launch on port {frontend_port}</port>
    </frontend>
    <backend>
      <runtime>Node.js with Express 5, running on Bun</runtime>
      <database>SQLite with Prisma ORM (PostgreSQL-compatible schema)</database>
      <validation>Joi for request validation</validation>
      <testing>Vitest + Supertest</testing>
      <authentication>JWT-based auth with bcrypt password hashing</authentication>
      <authorization>Role-based access control (RBAC)</authorization>
      <audit_trail>Comprehensive audit logging</audit_trail>
      <health_monitoring>Built-in health checks and metrics</health_monitoring>
    </backend>
    <communication>
      <api>RESTful endpoints with validation</api>
      <websockets>Socket.IO for real-time updates (optional)</websockets>
      <authentication>JWT tokens with HTTP-only cookies</authentication>
      <security>Helmet for security headers, rate limiting</security>
    </communication>
  </technology_stack>

  <prerequisites>
    <environment_setup>
      - Application configuration stored in config/autoo-todo.json
      - Frontend dependencies installed via bun install in /frontend
      - Backend dependencies installed via bun install in /backend
      - Database bootstrapped via bun run db:setup
      - Development assumes Bun environment with no implicit .env loading
    </environment_setup>
  </prerequisites>

  <core_features>
    <todo_management>
      - Create a todo with: title (required), optional description, optional due date
      - Edit todo title/description/due date with inline editing
      - Mark complete/incomplete with checkbox
      - Delete todo with confirmation dialog
      - Persist todos via backend (no localStorage-only solution)
      - Optimistic UI for fast interactions with rollback on failure
      - Bulk operations: clear all completed todos
    </todo_management>

    <organization>
      - Filters: All, Active, Completed with item counts
      - Sort options: created_at (default), due_date, title
      - Optional lists/projects (e.g., "Personal", "Work")
      - Optional tags with multi-select and simple string tags
      - Search by title/description with real-time filtering
      - Folder structure for organizing lists (optional)
    </organization>

    <ui_ux>
      - Clean layout: header + main list + footer stats
      - Keyboard-friendly: Enter to add, Escape to cancel edit
      - Inline editing (double click or edit button)
      - Clear empty states (no todos yet, no matches for filter/search)
      - Loading and error states for all API calls
      - Accessible controls with labels, focus management, and ARIA
      - Responsive design that works well on mobile widths
      - Dark/light mode toggle with system preference detection
    </ui_ux>

    <quality_safety>
      - Server-side validation for all writes using Joi schemas
      - Consistent error format: { error: { code, message, details? } }
      - Actionable error messages surfaced in UI
      - Rate limiting on API endpoints (configurable)
      - Authentication required for all operations
      - Role-based permissions (SYSOP, ADMIN, MANAGER, OPERATOR, VIEWER)
      - Audit logging for all data changes
      - XSS protection and security headers via Helmet
    </quality_safety>

    <collaboration>
      - Optional real-time updates via WebSocket
      - Share lists with other users (RBAC-controlled)
      - Comments on todos (optional feature)
      - Activity feed showing recent changes
    </collaboration>

    <advanced_features>
      - Recurring todos with cron expressions
      - Subtasks or nested todos
      - Attachments and file uploads
      - Email notifications for due dates
      - Export/import functionality (JSON, CSV)
      - Kanban board view
      - Calendar view with due dates
    </advanced_features>
  </core_features>

  <database_schema>
    <tables>
      <users>
        - id (integer, autoincrement)
        - username (string, unique)
        - email (string, unique)
        - passwordHash (string)
        - role ("SYSOP" | "ADMIN" | "MANAGER" | "OPERATOR" | "VIEWER")
        - resetToken (string, optional)
        - resetTokenExpiry (ISO string, optional)
        - isDeleted (boolean)
        - deletedAt (ISO string, optional)
        - deletedBy (integer, optional)
        - createdAt (ISO string)
        - updatedAt (ISO string)
        - failedLoginAttempts (integer)
        - lockedUntil (ISO string, optional)
        - passwordChangedAt (ISO string)
        - lastLoginAt (ISO string, optional)
      </users>

      <todos>
        - id (string, cuid)
        - title (string, 1..200)
        - description (string, optional, 0..2000)
        - status ("active" | "completed")
        - due_date (ISO string, optional)
        - created_at (ISO string)
        - updated_at (ISO string)
        - completed_at (ISO string, optional)
        - list_id (string, optional)
        - user_id (integer)
        - priority ("low" | "medium" | "high", default: "medium")
        - is_recurring (boolean, default: false)
        - recurrence_pattern (string, optional)
      </todos>

      <lists>
        - id (string, cuid)
        - name (string, 1..80)
        - created_at (ISO string)
        - updated_at (ISO string)
        - user_id (integer)
        - color (string, optional, hex color)
        - is_shared (boolean, default: false)
      </lists>

      <tags>
        - id (string, cuid)
        - name (string, 1..40, unique per user)
        - user_id (integer)
        - created_at (ISO string)
      </tags>

      <todo_tags>
        - todo_id (string)
        - tag_id (string)
        - PRIMARY KEY (todo_id, tag_id)
      </todo_tags>

      <audit_logs>
        - id (integer, autoincrement)
        - userId (integer, optional)
        - action (string)
        - resource (string)
        - resourceId (string, optional)
        - details (JSON, optional)
        - ipAddress (string, optional)
        - createdAt (ISO string)
      </audit_logs>

      <notifications>
        - id (integer, autoincrement)
        - userId (integer)
        - title (string)
        - message (string)
        - type (string, default: "INFO")
        - isRead (boolean, default: false)
        - createdAt (ISO string)
        - relatedTodoId (string, optional)
      </notifications>

      <user_notification_preferences>
        - id (integer, autoincrement)
        - user_id (integer, NOT NULL, UNIQUE)
        - preferences (JSON, NOT NULL)
        - created_at (ISO string, NOT NULL)
        - updated_at (ISO string, NOT NULL)
      </user_notification_preferences>

      <settings>
        - id (integer, autoincrement)
        - key (string, NOT NULL, UNIQUE)
        - category (string, NOT NULL)
        - value (string, NOT NULL)
        - encrypted_fields (string, optional)
        - updated_by (integer, NOT NULL)
        - created_at (ISO string, NOT NULL)
        - updated_at (ISO string, NOT NULL)
      </settings>

      <system_metrics>
        - id (integer, autoincrement)
        - name (string, NOT NULL)
        - value (real, NOT NULL)
        - unit (string, optional)
        - metadata (string, optional)
        - created_at (ISO string, NOT NULL)
      </system_metrics>
    </tables>
  </database_schema>

  <api_endpoints_summary>
    <health>
      - GET /api/health
      - GET /api/health/ready
      - GET /api/health/live
    </health>

    <authentication>
      - POST /api/auth/login
      - POST /api/auth/logout
      - POST /api/auth/register
      - POST /api/auth/refresh
      - POST /api/auth/reset-password
      - POST /api/auth/verify-reset-token
    </authentication>

    <users>
      - GET /api/users (admin only)
      - GET /api/users/:id
      - POST /api/users (admin only)
      - PUT /api/users/:id
      - DELETE /api/users/:id (soft delete)
      - PUT /api/users/:id/role (admin only)
    </users>

    <todos>
      - GET /api/todos
        - Query params: status=all|active|completed, q=search, sort=created_at|due_date|title, order=asc|desc, listId?, priority?
      - POST /api/todos
        - Body: { title, description?, dueDate?, listId?, tags?, priority?, recurrencePattern? }
      - GET /api/todos/:id
      - PUT /api/todos/:id
        - Body: { title?, description?, dueDate?, status?, listId?, tags?, priority? }
      - DELETE /api/todos/:id (soft delete)
      - POST /api/todos/:id/toggle
        - Body: { completed: boolean }
      - POST /api/todos/clear-completed
      - POST /api/todos/bulk-update
        - Body: { todoIds, updates }
    </todos>

    <lists>
      - GET /api/lists
      - POST /api/lists
        - Body: { name, color?, isShared? }
      - GET /api/lists/:id
      - PUT /api/lists/:id
        - Body: { name, color?, isShared? }
      - DELETE /api/lists/:id
      - POST /api/lists/:id/share
        - Body: { userId, role }
    </lists>

    <tags>
      - GET /api/tags
      - POST /api/tags
        - Body: { name }
      - DELETE /api/tags/:id
    </tags>

    <audit_logs>
      - GET /api/audit-logs
        - Query params: userId?, action?, resource?, dateFrom?, dateTo?
    </audit_logs>

    <dashboard>
      - GET /api/dashboard/stats
      - GET /api/dashboard/activity
    </dashboard>

    <data>
      - GET /api/data/export
        - Query params: format=json|csv
      - POST /api/data/import
    </data>

    <notifications>
      - GET /api/notifications
      - PUT /api/notifications/:id/read
      - PUT /api/notifications/read-all
      - DELETE /api/notifications/:id
    </notifications>

    <roles>
      - GET /api/roles
    </roles>

    <settings>
      - GET /api/settings
      - GET /api/settings/:key
      - PUT /api/settings/:key
      - PUT /api/settings/batch
    </settings>
  </api_endpoints_summary>

  <ui_layout>
    <main_structure>
      - Header: app title, list selector, search input, user menu
      - Main: todo input row + todo list + pagination
      - Footer: items left, filter pills, "Clear completed"
      - Optional right sidebar: list management, tags, calendar view
    </main_structure>

    <components>
      <todo_input>
        - Single-line input for title with expand for description
        - Add button + Enter key submit
        - Disabled while saving with loading indicator
        - Quick add for due date and priority
      </todo_input>

      <todo_item>
        - Checkbox for complete with smooth animation
        - Title + optional due date badge and priority indicator
        - Edit action (inline) and delete action
        - Tags display with add/remove
        - List indicator with color coding
      </todo_item>

      <filters>
        - All / Active / Completed pills with counts
        - Sort dropdown (created, due, title, priority)
        - List filter dropdown
        - Priority filter options
      </filters>

      <modals_overlays>
        - Edit todo modal with full form
        - List management modal
        - Settings modal with tabs
        - Share list modal
        - Export/import modal
        - Keyboard shortcuts help
      </modals_overlays>
    </components>
  </ui_layout>

  <design_system>
    <color_palette>
      - Primary: Blue accent (#3B82F6)
      - Success: Green (#10B981)
      - Warning: Yellow (#F59E0B)
      - Danger: Red (#EF4444)
      - Background: White (light), Gray-900 (dark)
      - Surface: Gray-50 (light), Gray-800 (dark)
      - Text: Gray-900 (light), Gray-100 (dark)
    </color_palette>

    <typography>
      - Sans-serif font stack (Inter, system-ui)
      - Todo items: text-base font-normal
      - Headers: text-lg font-semibold
      - Code: font-mono text-sm
    </typography>

    <components>
      <buttons>
        - Primary: blue background, white text, rounded-lg
        - Secondary: border with gray, hover:bg-gray-50
        - Ghost: transparent with hover:bg-gray-100
        - Icon: square p-2 with hover:bg-gray-100
      </buttons>

      <inputs>
        - Border with rounded-lg and focus:ring
        - Error state with red border and text
        - Disabled state with opacity-50
      </inputs>

      <cards>
        - Background with subtle border
        - Shadow on hover
        - Rounded corners (8px)
        - Padding: p-4
      </cards>
    </components>

    <animations>
      - Fade in/out for todos (200ms)
      - Slide for sidebar (300ms)
      - Scale for modal (150ms)
      - Smooth color transitions
    </animations>
  </design_system>

  <key_interactions>
    <todo_creation_flow>
      1. User types in todo input field
      2. Optional: Tab to description field or click date picker
      3. Press Enter or click Add button
      4. Todo appears immediately with optimistic update
      5. Backend saves and returns confirmation
      6. If error, revert to previous state with message
    </todo_creation_flow>

    <todo_edit_flow>
      1. Double-click todo or click edit button
      2. Inline fields appear with current values
      3. User edits and presses Enter or clicks Save
      4. Optimistic update shows changes immediately
      5. Backend validates and saves
      6. Error handling with inline messages
    </todo_edit_flow>

    <filter_search_flow>
      1. User types in search box
      2. List filters in real-time as user types
      3. Filter pills update counts dynamically
      4. URL updates with query params for sharing
      5. Clear button appears when filters active
    </filter_search_flow>
  </key_interactions>

  <implementation_steps>
    <step number="1">
      <title>Backend Foundation</title>
      <tasks>
        - Initialize monorepo with Bun and Spernakit template
        - Set up /frontend and /backend workspaces
        - Configure bunfig.toml and workspace scripts
        - Configure ESLint, Prettier, and TypeScript strict mode
        - Create config/autoo-todo.json and environment variants
        - Initialize Prisma with SQLite database and base schema
        - Implement authentication system with JWT and bcrypt
        - Implement authorization with RBAC
        - Add audit logging middleware
        - Implement todos CRUD with validation (Joi)
        - Add error handler + consistent error response
        - Create health endpoint and monitoring
      </tasks>
    </step>

    <step number="2">
      <title>Frontend Foundation</title>
      <tasks>
        - Create API client + typed DTOs
        - Build authentication flows (login, register, logout)
        - Build base layout and todo list rendering
        - Implement create/toggle/delete flows
        - Add loading/error states + optimistic updates
        - Implement edit flow, filters, sorting, and search
        - Add accessibility and keyboard shortcuts
      </tasks>
    </step>

    <step number="3">
      <title>Advanced Features</title>
      <tasks>
        - Implement lists and tags functionality
        - Add due dates and priority system
        - Build dashboard with statistics
        - Implement notification system
        - Add export/import functionality
        - Create sharing capabilities
      </tasks>
    </step>

    <step number="4">
      <title>Polish UX and Correctness</title>
      <tasks>
        - Add tests for key API routes and core UI behaviors
        - Optimize for mobile responsiveness
        - Implement dark mode toggle
        - Add confirmation dialogs for destructive actions
        - Polish animations and transitions
        - Implement keyboard shortcuts
        - Add comprehensive error handling
      </tasks>
    </step>

    <step number="5">
      <title>Real-time and Collaboration</title>
      <tasks>
        - Set up WebSocket server with Socket.IO
        - Implement real-time todo updates
        - Add presence indicators
        - Build activity feed
        - Add commenting system
      </tasks>
    </step>

    <step number="6">
      <title>Testing and Deployment</title>
      <tasks>
        - Write comprehensive unit and integration tests
        - Add E2E tests with Playwright
        - Performance optimization and profiling
        - Build Docker image
        - Configure CI/CD pipeline
        - Deploy to production with monitoring
      </tasks>
    </step>
  </implementation_steps>

  <success_criteria>
    <functionality>
      - All todo CRUD operations work reliably against backend
      - Filters/search/sort behave correctly and stay consistent
      - Data persists across page reloads and sessions
      - Authentication and authorization properly implemented
      - Audit trail captures all data modifications
    </functionality>

    <user_experience>
      - UI is responsive and keyboard accessible
      - Clear feedback for loading, success, and error conditions
      - Interactions feel fast with optimistic updates
      - Dark mode works seamlessly
      - Mobile experience is polished
    </user_experience>

    <technical_quality>
      - Type-safe DTOs between frontend and backend
      - Request validation on backend for all write endpoints
      - Tests cover core flows (create, toggle, edit, delete, filter)
      - Clean separation of concerns with service layer
      - TypeScript strict mode passes
      - Lint and format checks pass
    </technical_quality>

    <performance>
      - Initial page load under 2 seconds
      - API responses under 200ms (p95)
      - Smooth animations at 60fps
      - Handles 10,000+ todos without performance degradation
    </performance>

    <security>
      - All endpoints require authentication
      - RBAC properly enforced
      - Input validation prevents XSS
      - Rate limiting prevents abuse
      - Passwords properly hashed
      - Audit log for security events
    </security>
  </success_criteria>
</project_specification>
